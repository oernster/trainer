# Flatpak Build Instructions for Trainer

This document explains how to build a Flatpak package for the Trainer application.

## Prerequisites

Before building the Flatpak, you need to have the following installed on your Linux system:

1. **Flatpak** - The Flatpak runtime
2. **Flatpak Builder** - Tool for building Flatpak applications

### Installation Commands by Distribution:

**Debian/Ubuntu/Mint:**
```bash
sudo apt install flatpak flatpak-builder
```

**Fedora:**
```bash
sudo dnf install flatpak flatpak-builder
```

**Arch/Manjaro:**
```bash
sudo pacman -S flatpak flatpak-builder
```

**openSUSE:**
```bash
sudo zypper install flatpak flatpak-builder
```

## Building the Flatpak

1. **Transfer to Linux System**
   - Copy the entire Trainer project directory to a Linux system
   - Ensure all files are present, especially:
     - `main.py`
     - `src/` directory with all source code
     - `requirements.txt`
     - `build_flatpak.sh`
     - `assets/` directory (if present)

2. **Make the Build Script Executable**
   ```bash
   chmod +x build_flatpak.sh
   ```

3. **Run the Build Script**
   ```bash
   ./build_flatpak.sh
   ```

   The script will:
   - Detect your Linux distribution and desktop environment
   - Check for required dependencies
   - Set up the Flathub repository if needed
   - Install the KDE runtime (for Qt6/PySide6 support)
   - Build the Flatpak package
   - Create a single-file bundle named `trainer.flatpak`

4. **Install the Flatpak**
   
   The script will ask if you want to install immediately. You can also install manually:
   ```bash
   flatpak install --user trainer.flatpak
   ```

## Running the Application

Once installed, you can run Trainer using:
```bash
flatpak run com.oliverernster.Trainer
```

Or launch it from your desktop environment's application menu.

## Distribution

The generated `trainer.flatpak` file is self-contained and can be distributed to other Linux users. They can install it with:
```bash
flatpak install trainer.flatpak
```

The KDE runtime will be automatically downloaded if not already present on their system.

## Troubleshooting

### Build Fails on Arch-based Systems
The script includes special handling for Arch, Manjaro, and EndeavourOS. If you still encounter issues:
1. Ensure ca-certificates is installed: `sudo pacman -S ca-certificates`
2. Try using system-wide Flatpak installation instead of user installation

### Icon Not Showing in Menu
The script attempts to convert the ICO icon to PNG format. If this fails:
1. Manually convert `assets/train_emoji.ico` to PNG format
2. Place it in `~/.local/share/icons/hicolor/256x256/apps/com.oliverernster.Trainer.png`
3. Run `gtk-update-icon-cache -f -t ~/.local/share/icons/hicolor`

### Network Issues During Build
If behind a proxy, set environment variables before running the build:
```bash
export http_proxy=http://your-proxy:port
export https_proxy=http://your-proxy:port
./build_flatpak.sh
```

## Technical Details

- **Runtime**: org.kde.Platform//6.8 (provides Qt6 support for PySide6)
- **App ID**: com.oliverernster.Trainer
- **Permissions**: Network access, home directory access, X11/Wayland display
- **Python Version**: 3.12 (provided by the KDE runtime)

## Notes for Developers

The Flatpak manifest (`com.oliverernster.Trainer.json`) is generated by the build script. If you need to modify the build configuration:

1. Edit the manifest generation section in `build_flatpak.sh`
2. Key areas to modify:
   - `finish-args`: Application permissions
   - `modules`: Build steps and dependencies
   - Python dependencies in the `python-dependencies` module

The application uses a runner script (`trainer-runner.sh`) to set up the Python environment correctly within the Flatpak sandbox.